# ADR-007: DRY content and metadata consolidation

## Status

Accepted

## Date

2026-02-08

## Context

The site had four separate files containing overlapping editorial content:

- **`content/cv.content.json`** — the primary content file with headline, summary, positioning, experience, education, and links.
- **`content/cv.og.json`** — Open Graph metadata (title, description, image) for the CV page.
- **`content/jsonld.json`** — a JSON-LD `@graph` with Schema.org structured data (Person, WebPage, credentials, publications, occupation).
- **`public/manifest.webmanifest`** — a static Web App Manifest with name and description.

The descriptive text in these files overlapped: the OG description, JSON-LD Person description, and manifest description all paraphrased the same positioning. When the headline and first paragraph were reworked editorially, three files needed manual updates to stay in sync. This violated DRY and created a practical obstacle to editorial iteration.

### Options evaluated

1. **Keep separate files, synchronise manually.** Simple to understand but error-prone. Any editorial change requires updating multiple files.
2. **Single source in `cv.content.json`, derive everything else at build/render time.** Adds a small amount of TypeScript code but eliminates all duplicate editorial content.

## Decision

**Derive all metadata from `cv.content.json` — eliminate the three satellite files.**

A `meta.summary` field was added to `cv.content.json` to serve as the single short description used across OG, JSON-LD, and the manifest. The derivation chain:

- **Open Graph** — constructed in `lib/cv-content.ts` from `meta.name` and `meta.summary`.
- **JSON-LD** — constructed in `lib/jsonld.ts`. Editorial content (name, summary, education, links) comes from `cv.content.json`. Structured-data-specific constants (publications, `knowsAbout`, occupation metadata) are defined in the module because they have no editorial equivalent. The WebPage node's `name` and `description` match the HTML `<title>` and `<meta name="description">` by construction — they use the same values from `cvOpenGraph`.
- **Web App Manifest** — generated by `app/manifest.ts` (a Next.js dynamic manifest route) from `meta.name` and `meta.summary`.

### Eliminated files

| File                          | Replaced by         |
| ----------------------------- | ------------------- |
| `content/cv.og.json`          | `lib/cv-content.ts` |
| `content/jsonld.json`         | `lib/jsonld.ts`     |
| `public/manifest.webmanifest` | `app/manifest.ts`   |

## Consequences

**Benefits:**

- An editorial change to `cv.content.json` automatically propagates to OG metadata, JSON-LD, and the manifest — no manual synchronisation needed.
- The JSON-LD graph is richer than the old static file because it can programmatically generate credential and organisation nodes from the education array.
- The manifest is now a Next.js route, consistent with how the framework recommends generating manifests.

**Trade-offs:**

- The JSON-LD is no longer a single readable JSON file — the graph is assembled in TypeScript. This is mitigated by clear TSDoc and a modular `buildGraph()` function where each category of nodes is constructed independently.
- Adding new JSON-LD nodes requires editing TypeScript rather than JSON. In practice this is straightforward and provides type safety.
- The `meta.summary` field must be written to work in all three contexts (OG previews, JSON-LD descriptions, manifest description). This is a light editorial constraint — the summary should be a confident one-sentence positioning statement rather than a narrative opener. **Note:** [ADR-011](011-domain-appropriate-descriptions.md) evolves this understanding — these contexts are fundamentally different domains, and the single-string approach is an interim simplification. The target state is domain-appropriate descriptions, implemented through the knowledge graph plan.

## Related

- `content/cv.content.json` — single source of truth
- `lib/cv-content.ts` — OG metadata derivation
- `lib/jsonld.ts` — JSON-LD graph construction
- `app/manifest.ts` — dynamic manifest generation
- `docs/architecture/README.md` — Content & Metadata section
